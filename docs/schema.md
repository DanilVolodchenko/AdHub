## FastAPI автоматически создает docs и redoc
по адресу `127.0.0.1:8000/docs` и `127.0.0.1:8000/redoc`

## Регистрация пользователя

### Эндпоинт

`POST /register`

### Описание

Этот эндпоинт предназначен для регистрации новых пользователей в системе.

### Параметры запроса

- username:
    - Тип: Строка
    - Описание: username пользователя.
- email:
    - Тип: Строка
    - Описание: email пользователя.
- password:
    - Тип: Строка
    - Описание: Пароль пользователя.
- role:
    - Тип: Строка
    - Описание: Роль пользователя.

### Ход выполнения

1. Проверка существования пользователя с указанным именем в базе данных.
2. Если пользователь уже существует, генерация исключения с кодом HTTP 400 (BAD REQUEST) и сообщением 'Такой
   пользователь уже зарегистрирован!'.
3. Создание нового пользователя в базе данных, используя переданные данные (имя пользователя, электронная почта, пароль,
   роль).
4. Возврат информации о зарегистрированном пользователе в формате JSON, содержащей имя пользователя и электронную почту.

### Пример ответа

```
{
  "id": 1,
  "username": "string",
  "email": "user@example.com",
  "role": "user"
}
```

---

## Получение токена

### Эндпоинт

`POST /token`

### Описание

Этот эндпоинт предназначен для аутентификации пользователя и выдачи токена.

### Параметры запроса

- username:
    - Тип: Строка
    - Описание: Имя пользователя.
- password:
    - Тип: Строка
    - Описание: Пароль пользователя.

### Ход выполнения

1. Поиск пользователя в базе данных по указанному имени.
2. Проверка введенного пароля с хэшированным паролем пользователя.
3. В случае неудачной аутентификации возврат ответа с кодом HTTP 401 и сообщением 'Неверные данные'.
4. Создание JWT-токена для пользователя.
5. Возврат ответа в формате JSON с токеном.

### Пример ответа

```
{
  "token_type": "jwt",
  "token": "сгенерированный-токен"
}
```

---

## Получение информации о текущем пользователе

### Эндпоинт

`GET /users/me`

### Описание

Этот эндпоинт предназначен для получения информации о текущем пользователе.

### Параметры запроса

- token:
    - Тип: Строка
    - Описание: JWT-токен, используемый для аутентификации пользователя.

### Ход выполнения

1. Попытка получить информацию о текущем пользователе с использованием переданного токена.
2. В случае ошибки с токеном возврат ответа с кодом HTTP 401 и сообщением 'Неверный токен!'.
3. Возврат ответа в формате JSON с кодом HTTP 200 и информацией о текущем пользователе.

### Пример ответа

```
{
  "id": 0,
  "username": "string",
  "email": "string@example.com",
  "hash_password": "string",
  "role": "user"
}
```

---

## Изменение роли пользователя

### Эндпоинт

`PATCH /users/{user_id}`

### Описание

Этот эндпоинт предназначен для изменения роли пользователя.

### Параметры запроса

- user_id:
    - Тип: Целое число
    - Описание: id пользователя, чью роль необходимо изменить.
- token:
    - Тип: Строка
    - Описание: JWT-токен, используемый для аутентификации пользователя.

### Ход выполнения

1. Попытка получить информацию о текущем пользователе с использованием переданного токена.
2. В случае ошибки с токеном возврат ответа с кодом HTTP 401 и сообщением 'Неверный токен!'.
3. Проверка роли текущего пользователя. Если роль не 'admin', возврат ответа с кодом HTTP 400 и
   сообщением 'Нет прав для этой операции!'.
4. В случае успешного изменения роли, возврат ответа с кодом HTTP 200 и сообщением об успешной операции.
5. В случае отсутствия пользователя с указанным id, возврат ответа с кодом HTTP 404 и сообщением 'Такого
   пользователя не существует!'.
6. В случае ошибки при обновлении роли, возврат ответа с кодом HTTP 400 и сообщением 'Нет прав для этой операции!'.

### Пример ответа

```
{
  "id": 7,
  "username": "string",
  "email": "user@example.com",
  "hash_password": "asdf",
  "role": "admin"
}
```

---

## Получение списка объявлений

### Эндпоинт

`GET /ads`

### Описание

Этот эндпоинт предназначен для получения списка объявлений.

### Ход выполнения

1. Получение списка объявлений из базы данных.
2. Возврат ответа с кодом HTTP 200 и списком объявлений в формате JSON.

### Пример ответа

```
[
  {
    "id": 1
    "title": "Покупка",
    "description": "Описание объявления 1",
    "owner_id": 1
  },
  {
    "id": 2
    "title": "Продажа",
    "description": "Описание объявления 2",
    "owner_id": 2
  }
]
```

---

## Получение определенного объявления

### Эндпоинт

`GET /ads/{ad_id}`

### Описание

Этот эндпоинт предназначен для получения определенного объявления.

### Параметры запроса

- ad_id:
    - Тип: Целое число
    - Описание: id объявления, которое необходимо получить.

### Ход выполнения

1. Поиск объявления в базе данных по указанному id.
2. В случае отсутствия объявления, возврат ответа с кодом HTTP 404 и сообщением 'Объявление не найдено!'.
3. Возврат ответа с кодом HTTP 200 и данными объявления в формате JSON.

### Пример ответа

```
{
  "id": 1
  "title": "Продажа",
  "description": "писание объявления",
  "owner_id": 1
}
```

---

## Создание объявления

### Эндпоинт

`POST /ads`

### Описание

Этот эндпоинт предназначен для создания нового объявления.

### Параметры запроса

- token:
    - Тип: Строка
    - Описание: JWT-токен, используемый для аутентификации пользователя.
- title:
    - Тип: Строка
    - Описание: Название объявления.
- description:
    - Тип: Строка
    - Описание: Описание объявления.

### Ход выполнения

1. Попытка получить информацию о текущем пользователе с использованием переданного токена.
2. В случае ошибки с токеном возврат ответа с кодом HTTP 401 и сообщением 'Неверный токен!'.
3. Создание нового объявления в базе данных, используя переданные данные.
4. Возврат ответа с кодом HTTP 201 и сообщением 'Объявление успешно создано!'.

### Пример ответа

```
{
  "id": 1,
  "title": "Продажа",
  "description": "string",
  "owner_id": 1
}
```

---

## Удаление определенного объявления

### Эндпоинт

`DELETE /ads/{ad_id}`

### Описание

Этот эндпоинт предназначен для удаления определенного объявления.

### Параметры запроса

- ad_id:
    - Тип: Целое число
    - Описание: id объявления, которое необходимо удалить.
- token:
    - Тип: Строка
    - Описание: JWT-токен, используемый для аутентификации пользователя.

### Ход выполнения

1. Попытка получить информацию о текущем пользователе с использованием переданного токена.
2. В случае ошибки с токеном возврат ответа с кодом HTTP 401 и сообщением 'Неверный токен!'.
3. Попытка удалить объявление с указанным id, учитывая права текущего пользователя.
4. В случае отсутствия прав для удаления, возврат ответа с кодом HTTP 401 и сообщением 'Нет прав на удаление
   объявления!'.
5. Возврат ответа с кодом HTTP 200 и сообщением 'Объявление успешно удалено!'.

### Пример ответа

```
{
  "detail": "Объявление успешно удалено!"
}
```

---

## Получение списка комментариев

### Эндпоинт

`GET /comments`

### Описание

Этот эндпоинт предназначен для получения списка комментариев.

### Ход выполнения

1. Получение списка комментариев из базы данных.
2. Возврат ответа с кодом HTTP 200 и списком комментариев.

### Пример ответа

```
[
  {
    "id": 1
    "text": "string",
    "owner_id": 1,
    "ad_id": 2
  },
  {
    "id": 2
    "text": "string",
    "owner_id": 3,
    "ad_id": 2
  }
```

---

## Получение определенного комментария

### Эндпоинт

`GET /comments/{comment_id}`

### Описание

Этот эндпоинт предназначен для получения определенного комментария.

### Параметры запроса

- comment_id:
    - Тип: Целое число
    - Описание: id комментария, который необходимо получить.

### Ход выполнения

1. Поиск комментария в базе данных по указанному id.
2. В случае отсутствия комментария, возврат ответа с кодом HTTP 404 и сообщением 'Комментарий не найден!'.
3. Возврат ответа с кодом HTTP 200 и данными комментария в формате JSON.

### Пример ответа

```
{
  "id": 1,
  "text": "string",
  "owner_id": 2,
  "ad_id": 3
}
```

---

## Создание комментария к объявлению

### Эндпоинт

`POST /comments/{ad_id}`

### Описание

Этот эндпоинт предназначен для создания нового комментария к объявлению.

### Параметры запроса

- ad_id:
    - Тип: Целое число
    - Описание: id объявления, к которому создается комментарий.
- token:
    - Тип: Строка
    - Описание: JWT-токен, используемый для аутентификации пользователя.
- comment:
    - Тип: CommentCreateSchema
    - Описание: Объект с данными для создания комментария.

### Ход выполнения

1. Попытка получить информацию о текущем пользователе с использованием переданного токена.
2. В случае ошибки с токеном возврат ответа с кодом HTTP 401 и сообщением 'Неверный токен!'.
3. Попытка создать новый комментарий к объявлению в базе данных, используя переданные данные.
4. В случае отсутствия объявления, возврат ответа с кодом HTTP 404 и сообщением 'Объявление не найдено!'.
5. Возврат ответа с кодом HTTP 201 и сообщением 'Комментарий успешно создан!'.

### Пример ответа

```
{
  "id": 1,
  "text": "string",
  "owner_id": 1,
  "ad_id": 1
}
```

---

## Удаление комментария

### Эндпоинт

`DELETE /comments/{comment_id}`

### Описание

Этот эндпоинт предназначен для удаления комментария.

### Параметры запроса

- comment_id:
    - Тип: Целое число
    - Описание: id комментария, который необходимо удалить.
- token:
    - Тип: Строка
    - Описание: JWT-токен, используемый для аутентификации пользователя.

### Ход выполнения

1. Попытка получить информацию о текущем пользователе с использованием переданного токена.
2. В случае ошибки с токеном возврат ответа с кодом HTTP 401 и сообщением 'Неверный токен!'.
3. Попытка удалить комментарий с указанным id, учитывая права текущего пользователя.
4. Возврат ответа с кодом HTTP 200 и сообщением 'Комментарий успешно удален!'.

### Пример ответа

```
{
  "detail": "Комментарий успешно удален!"
}
```